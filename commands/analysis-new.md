# /analysis new

Start a new analysis. Supports `--from {Quick ID}` for Quick-to-Full succession.

## Instructions

### Step 1: Check initialization

Verify `.analysis/config.md` exists. If not, tell the user to run `/analysis init` first.
Read config.md to load team context (metrics, stakeholders, data stack).

### Step 2: Parse arguments

- If `--from {ID}` is provided, this is a Quickâ†’Full succession (skip to Step 2c)
- Otherwise, proceed to Step 2a

### Step 2a: Ask analysis type

Use AskUserQuestion:

**Q1. What type of analysis?**

- ðŸ” **Investigation** â€” "Why did this happen?" Root cause analysis, anomaly detection, ad-hoc deep dives.
- ðŸ“ˆ **Modeling** â€” "Can we predict/classify/segment?" Statistical modeling, ML, forecasting.

(Phase 2 types â€” not yet available:)
- ðŸ“Š Monitoring â€” periodic metric health check
- ðŸ§ª Experiment â€” A/B test analysis

### Step 2b: Ask mode and details

**Q2. Analysis mode?**
- **Full** â€” 5 ALIVE files + full checklists.
- **Quick** â€” Single file with abbreviated ALIVE flow.

**Q3. Analysis title?**
- Free text input

**Q4. (Full only) Brief description**
- Investigation: "What do you want to find out?"
- Modeling: "What do you want to predict or classify?"
- This seeds the ASK phase.

### Step 2c: Quickâ†’Full succession

- Read the Quick file referenced by `--from {ID}`
- Extract content from each ALIVE section
- Use as seed content for Full analysis files
- Add a reference link in the Quick file: `> â¬†ï¸ Promoted to Full: {new Full ID}`

### Step 3: Generate ID

Read `.analysis/status.md` to determine the next sequence number for today.

- Full: `F-{YYYY}-{MMDD}-{seq}` (e.g., `F-2026-0210-001`)
- Quick: `Q-{YYYY}-{MMDD}-{seq}` (e.g., `Q-2026-0210-002`)

Sequence resets daily, starts at 001.

### Step 4: Create files

---

#### 4A. Full Investigation

Create folder: `analyses/active/{ID}_{title-slug}/`

Generate `01_ask.md`:
```markdown
# ASK: {title}
> ID: {ID} | Type: ðŸ” Investigation | Stage: â“ ASK | Started: {YYYY-MM-DD}

## Problem Definition
- Question:
- Requester:
- Background:

## Success Criteria
- What does "done" look like?

## Assumptions
-

## Scope
- In scope:
- Out of scope:
- Deadline:

## Data Sources
- Primary:
- Secondary:

---
{Insert ASK checklist from .analysis/checklists/ask.md}
```

Generate `assets/README.md`:
```markdown
# Assets: {title}
> Analysis ID: {ID}

## Contents
(Describe your SQL files, notebooks, charts, and other artifacts here)

## Key Files
- (add as you work)
```

---

#### 4B. Full Modeling

Create folder: `analyses/active/{ID}_{title-slug}/`

Generate `01_ask.md`:
```markdown
# ASK: {title}
> ID: {ID} | Type: ðŸ“ˆ Modeling | Stage: â“ ASK | Started: {YYYY-MM-DD}

## Objective
- What are you trying to predict / classify / segment?
- Business impact: Why does this matter?

## Success Criteria
- Target metric (e.g., "AUC > 0.8", "MAPE < 10%")
- Business success (e.g., "reduce churn by 5% if deployed")

## Assumptions
-

## Scope
- Target variable:
- Candidate features:
- Training period:
- Prediction horizon:

## Data Sources
- Primary:
- Secondary:

## Constraints
- Must be interpretable? (Yes / No)
- Real-time requirement? (Yes / No)
- Guardrail metrics to watch: (reference from config.md)

---
{Insert ASK checklist from .analysis/checklists/ask.md}
```

Generate `assets/README.md` (same as Investigation).

**Modeling-specific stage templates** (generated by `/analysis next`):

**02_look.md for Modeling:**
```markdown
# LOOK: {title}
> ID: {ID} | Type: ðŸ“ˆ Modeling | Stage: ðŸ‘€ LOOK | Updated: {YYYY-MM-DD}

## Target Variable
- Distribution:
- Class balance (if classification):
- Missing rate:

## Feature Exploration
| Feature | Type | Missing % | Notes |
|---------|------|-----------|-------|
| | | | |

## Data Quality
- Outliers:
- Leakage risk:
- Time-based splits needed?

## Sampling Strategy
- Training / Validation / Test split:
- Stratification:

---
{Insert LOOK checklist}
```

**03_investigate.md for Modeling:**
```markdown
# INVESTIGATE: {title}
> ID: {ID} | Type: ðŸ“ˆ Modeling | Stage: ðŸ” INVESTIGATE | Updated: {YYYY-MM-DD}

## Baseline
- Naive baseline method:
- Baseline performance:

## Model Selection
| Model | Hyperparameters | Train Score | Val Score | Notes |
|-------|----------------|-------------|-----------|-------|
| | | | | |

## Best Model
- Model:
- Key features (importance / coefficients):
- Performance vs success criteria:

## Validation
- Cross-validation results:
- Test set performance:
- Overfitting check (train vs val gap):

## Error Analysis
- Where does the model fail?
- Systematic bias?

## Reproducibility
- Code location: `assets/`
- Environment / dependencies:
- Random seed:

---
{Insert INVESTIGATE checklist}
```

**04_voice.md for Modeling:**
```markdown
# VOICE: {title}
> ID: {ID} | Type: ðŸ“ˆ Modeling | Stage: ðŸ“¢ VOICE | Updated: {YYYY-MM-DD}

## Executive Summary
(1-3 sentences: what the model does, how well it works, business impact)

## Model Performance
- Key metric: {metric} = {value} (target was {target})
- Comparison to baseline: {improvement}

## Business Interpretation
- What does the model tell us about the business?
- Top drivers / features:

## Recommendations
- Deploy to production? (Yes / No / Conditional)
- Expected business impact:
- Monitoring plan:

## Limitations & Risks
- Known failure modes:
- Data freshness requirements:
- Guardrail metrics impact:

## Audience-specific Messages

### For {stakeholder}
-

---
{Insert VOICE checklist}
```

**05_evolve.md** uses the same template for both types.

---

#### 4C. Quick Analysis (any type)

Create file: `analyses/active/quick_{ID}_{title-slug}.md`

```markdown
# Quick: {title}
> ID: {ID} | Type: {ðŸ” Investigation / ðŸ“ˆ Modeling} | Status: ðŸŸ¡ In Progress | Started: {YYYY-MM-DD}

## ASK
- Question / Objective:
- Background:
- Deadline:

## LOOK
- Data source:
- Notable findings:

## INVESTIGATE
- Method:
- Result:

## VOICE
- Conclusion (1-2 sentences):
- Audience:

## EVOLVE
- Follow-up needed: Yes / No
- Next question:

---
Check: ðŸŸ¢ Proceed / ðŸ”´ Stop
- [ ] Is the purpose clear?
- [ ] Is the data/method appropriate?
- [ ] Does the conclusion answer the question?

---
> ðŸ’¡ If this analysis is getting bigger: `/analysis new --from {ID}`
```

---

### Step 5: Update status.md

Add new entry to the Active table in `.analysis/status.md`.
Include the Type column.
Update the "Last updated" timestamp.

### Step 6: Confirmation

Tell the user:
- New analysis created with ID and type
- Show file path(s)
- Reference relevant metrics from config.md if applicable
- For Full: suggest filling out 01_ask.md, then running `/analysis next`
- For Quick: suggest filling out each section in order
- For Modeling: mention "INVESTIGATE will include model comparison and validation templates"
